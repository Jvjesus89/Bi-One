<div class="p-6 max-w-4xl mx-auto font-sans">
  <h1 class="text-2xl font-bold mb-4 text-slate-800">Cadastro de Clientes</h1>

  <!-- Formulário de Cadastro -->
  <form (ngSubmit)="submit()" class="space-y-4 bg-white p-6 rounded-lg shadow-md mb-8">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label for="razao" class="block text-sm font-medium text-slate-600 mb-1">Razão Social</label>
        <input id="razao" name="razao" required class="w-full px-3 py-2 border border-slate-300 rounded-md"
               [(ngModel)]="razao">
      </div>
      <div>
        <label for="fantasia" class="block text-sm font-medium text-slate-600 mb-1">Nome Fantasia</label>
        <input id="fantasia" name="fantasia" class="w-full px-3 py-2 border border-slate-300 rounded-md"
               [(ngModel)]="fantasia">
      </div>
    </div>

    <div>
      <label for="cpcn" class="block text-sm font-medium text-slate-600 mb-1">CNPJ / CPF</label>
      <input id="cpcn" name="cpcn" type="number" class="w-full px-3 py-2 border border-slate-300 rounded-md"
             [(ngModel)]="cpcn">
    </div>

    <div>
      <label for="observacoes" class="block text-sm font-medium text-slate-600 mb-1">Observações (opcional)</label>
      <textarea id="observacoes" name="observacoes" type="text" class="w-full px-3 py-2 border border-slate-300 rounded-md h-18"
             [(ngModel)]="observacoes"></textarea>
    </div>

    <div>
      <label class="block text-sm font-medium text-slate-600 mb-1">Contatos (telefone e e-mail)</label>
      @for (tel of telefones(); track $index) {
        <div class="grid grid-cols-1 md:grid-cols-4 gap-2 items-center mb-2">
          <input [(ngModel)]="tel.celular" name="celular{{$index}}" class="md:col-span-1 px-3 py-2 border rounded-md" placeholder="Celular (WhatsApp)">
          <input [(ngModel)]="tel.email" name="email{{$index}}" type="email" class="md:col-span-1 px-3 py-2 border rounded-md" placeholder="E-mail (opcional)">
          <input [(ngModel)]="tel.responsavel" name="responsavel{{$index}}" class="md:col-span-1 px-3 py-2 border rounded-md" placeholder="Responsável (opcional)">
          <div class="md:col-span-1">
            @if (telefones().length > 1) {
              <button type="button" (click)="removePhoneField($index)" class="px-3 py-1.5 bg-red-500 text-white rounded-md text-sm">Remover</button>
            }
          </div>
        </div>
      }
      <button type="button" (click)="addPhoneField()" class="mt-2 px-3 py-1.5 bg-sky-600 text-white rounded-md text-sm">Adicionar Contato</button>
    </div>

    <div class="flex justify-end gap-2">
      <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-md font-semibold">Salvar Cliente</button>
    </div>
  </form>

  <!-- Seção de Clientes Cadastrados -->
  <section class="mt-6">
    <h2 class="text-lg font-semibold mb-4 text-slate-700">Clientes Cadastrados</h2>
    <ul class="space-y-3">
      @for (cliente of clientes(); track cliente.idcliente) {
        <li class="bg-white p-4 rounded-lg shadow-md">
          <div class="flex justify-between items-start">
              <div>
                <div class="font-bold text-slate-800">{{ cliente.razao }}</div>
                <div class="text-sm text-slate-600">{{ cliente.fantasia }}</div>
                @if(cliente.cpcn) {
                  <div class="text-xs text-slate-500 mt-1">CNPJ/CPF: {{ cliente.cpcn }}</div>
                }
              </div>
              <button (click)="deleteCliente(cliente.idcliente)" class="px-3 py-1.5 bg-red-500 text-white rounded-md text-sm">Excluir</button>
          </div>
          <div class="mt-3 border-t pt-3">
            <h4 class="text-sm font-semibold text-slate-700">Contatos:</h4>
            @for(tel of cliente.clientes_telefone; track tel.idtelefone) {
                <div class="text-sm text-slate-600 flex flex-wrap gap-2 items-center">
                    @if(tel.celular) {
                      <span>- {{ tel.celular }}</span>
                    }
                    @if(tel.email) {
                      <span class="text-slate-500">{{ tel.email }}</span>
                    }
                    @if(tel.responsavel) {
                      <span class="text-slate-500">({{ tel.responsavel }})</span>
                    }
                </div>
            }
          </div>
        </li>
      } @empty {
        <li class="bg-white p-4 rounded-lg shadow-sm text-center text-slate-500">Nenhum cliente cadastrado ainda.</li>
      }
    </ul>
  </section>
</div>

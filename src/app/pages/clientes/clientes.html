<div class="p-6 max-w-4xl mx-auto font-sans">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold text-slate-100">
      @if (clienteSelecionado()) {
        Editar Cliente
      } @else {
        Cadastro de Clientes
      }
    </h1>
    @if (clienteSelecionado()) {
      <div class="bg-amber-500/20 border border-amber-500 px-4 py-2 rounded-lg flex items-center gap-3">
        <span class="text-amber-400 font-semibold">✏️ Editando:</span>
        <span class="text-slate-100">{{ clienteSelecionado()?.razao || clienteSelecionado()?.fantasia }}</span>
      </div>
    }
  </div>

  <!-- Formulário de Cadastro/Edição -->
  <form (ngSubmit)="submit()" class="space-y-4 bg-slate-800/60 p-6 rounded-lg shadow-md mb-8">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label for="razao" class="block text-sm font-medium text-slate-300 mb-1">Razão Social</label>
        <input id="razao" name="razao" required class="w-full px-3 py-2 border border-slate-600 rounded-md bg-slate-700 text-slate-200"
               [(ngModel)]="razao">
      </div>
      <div>
        <label for="fantasia" class="block text-sm font-medium text-slate-300 mb-1">Nome Fantasia</label>
        <input id="fantasia" name="fantasia" class="w-full px-3 py-2 border border-slate-600 rounded-md bg-slate-700 text-slate-200"
               [(ngModel)]="fantasia">
      </div>
    </div>

    <div>
      <label for="cpcn" class="block text-sm font-medium text-slate-300 mb-1">CNPJ / CPF</label>
      <input id="cpcn" name="cpcn" type="number" class="w-full px-3 py-2 border border-slate-600 rounded-md bg-slate-700 text-slate-200"
             [(ngModel)]="cpcn">
    </div>

    <div>
      <label for="observacoes" class="block text-sm font-medium text-slate-300 mb-1">Observações (opcional)</label>
      <textarea id="observacoes" name="observacoes" type="text" class="w-full px-3 py-2 border border-slate-600 rounded-md h-18 bg-slate-700 text-slate-200"
             [(ngModel)]="observacoes"></textarea>
    </div>

    <div>
      <label class="block text-sm font-medium text-slate-300 mb-1">Contatos (telefone e e-mail)</label>
      @for (tel of telefones(); track $index) {
        <div class="grid grid-cols-1 md:grid-cols-4 gap-2 items-center mb-2">
          <input [(ngModel)]="tel.celular" name="celular{{$index}}" class="md:col-span-1 px-3 py-2 border border-slate-600 rounded-md bg-slate-700 text-slate-200" placeholder="Celular (WhatsApp)">
          <input [(ngModel)]="tel.email" name="email{{$index}}" type="email" class="md:col-span-1 px-3 py-2 border border-slate-600 rounded-md bg-slate-700 text-slate-200" placeholder="E-mail (opcional)">
          <input [(ngModel)]="tel.responsavel" name="responsavel{{$index}}" class="md:col-span-1 px-3 py-2 border border-slate-600 rounded-md bg-slate-700 text-slate-200" placeholder="Responsável (opcional)">
          <div class="md:col-span-1">
            @if (telefones().length > 1) {
              <button type="button" (click)="removePhoneField($index)" class="px-3 py-1.5 bg-red-500 text-white rounded-md text-sm">Remover</button>
            }
          </div>
        </div>
      }
      <button type="button" (click)="addPhoneField()" class="mt-2 px-3 py-1.5 bg-amber-500 text-slate-900 rounded-md text-sm font-semibold">Adicionar Contato</button>
    </div>

    <div class="flex justify-end gap-2">
      @if (clienteSelecionado()) {
        <button type="button" (click)="limparFormulario()" class="px-4 py-2 bg-slate-600 text-white rounded-md font-semibold hover:bg-slate-700">Cancelar</button>
        <button type="submit" class="px-4 py-2 bg-amber-500 text-slate-900 rounded-md font-semibold hover:bg-amber-600">Atualizar Cliente</button>
      } @else {
        <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-md font-semibold hover:bg-green-700">Salvar Cliente</button>
      }
    </div>
  </form>

  <!-- Seção de Clientes Cadastrados - Só mostra se NÃO houver filtro -->
  @if (!clienteSelecionado()) {
    <section class="mt-6">
    <h2 class="text-lg font-semibold mb-4 text-slate-100">Clientes Cadastrados</h2>
    <ul class="space-y-3">
      @for (cliente of clientes(); track cliente.idcliente) {
        <li class="bg-slate-800/60 p-4 rounded-lg shadow-md">
              <div class="flex justify-between items-start">
              <div>
                <div class="font-bold text-slate-100">{{ cliente.razao }}</div>
                <div class="text-sm text-slate-300">{{ cliente.fantasia }}</div>
                @if(cliente.cpcn) {
                  <div class="text-xs text-slate-400 mt-1">CNPJ/CPF: {{ cliente.cpcn }}</div>
                }
              </div>
              <div class="flex gap-2">
                <button (click)="selectCliente(cliente)" class="px-3 py-1.5 bg-amber-500 text-white rounded-md text-sm">Selecionar</button>
                <button (click)="deleteCliente(cliente.idcliente)" class="px-3 py-1.5 bg-red-500 text-white rounded-md text-sm">Excluir</button>
              </div>
          </div>
          <div class="mt-3 border-t border-slate-700 pt-3">
            <h4 class="text-sm font-semibold text-slate-200">Contatos:</h4>
            @for(tel of cliente.clientes_telefone; track tel.idtelefone) {
                <div class="text-sm text-slate-300 flex flex-wrap gap-2 items-center">
                    @if(tel.celular) {
                      <span>- {{ tel.celular }}</span>
                    }
                    @if(tel.email) {
                      <span class="text-slate-400">{{ tel.email }}</span>
                    }
                    @if(tel.responsavel) {
                      <span class="text-slate-400">({{ tel.responsavel }})</span>
                    }
                </div>
            }
          </div>
        </li>
      } @empty {
        <li class="bg-slate-800/60 p-4 rounded-lg shadow-sm text-center text-slate-400">Nenhum cliente cadastrado ainda.</li>
      }
    </ul>
  </section>
  }
</div>

<div class="p-6 max-w-7xl mx-auto font-sans">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-slate-100">
      @if (financeiroSelecionado()) {
        Editar Lan√ßamento Financeiro
      } @else {
        Cadastro Financeiro
      }
    </h1>
    @if (clienteSelecionado()) {
      <div class="bg-amber-500/20 border border-amber-500 px-4 py-2 rounded-lg flex items-center gap-3">
        <span class="text-amber-400 font-semibold">üìä Filtrando por:</span>
        <span class="text-slate-100">{{ clienteSelecionado()?.razao || clienteSelecionado()?.fantasia }}</span>
      </div>
    }
  </div>

  <!-- Cards de M√©tricas -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <div class="bg-gradient-to-br from-green-600 to-green-800 p-4 rounded-lg shadow-lg">
      <div class="text-green-200 text-sm font-medium">Total Receita</div>
      <div class="text-2xl font-bold text-white mt-1">{{ formatarMoeda(totalReceita()) }}</div>
    </div>
    <div class="bg-gradient-to-br from-red-600 to-red-800 p-4 rounded-lg shadow-lg">
      <div class="text-red-200 text-sm font-medium">Total Despesa</div>
      <div class="text-2xl font-bold text-white mt-1">{{ formatarMoeda(totalDespesa()) }}</div>
    </div>
    <div class="bg-gradient-to-br from-blue-600 to-blue-800 p-4 rounded-lg shadow-lg">
      <div class="text-blue-200 text-sm font-medium">Saldo</div>
      <div class="text-2xl font-bold text-white mt-1" [class.text-green-300]="saldo() >= 0" [class.text-red-300]="saldo() < 0">
        {{ formatarMoeda(saldo()) }}
      </div>
    </div>
    <div class="bg-gradient-to-br from-amber-500 to-amber-700 p-4 rounded-lg shadow-lg">
      <div class="text-amber-200 text-sm font-medium">Pendentes</div>
      <div class="text-2xl font-bold text-white mt-1">{{ pendentes() }}</div>
    </div>
  </div>

  <!-- Formul√°rio -->
  <form (ngSubmit)="submit()" class="space-y-4 bg-slate-800/60 p-6 rounded-lg shadow-md mb-8">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-slate-300 mb-1">Cliente *</label>
        <app-cliente-autocomplete
          [clientes]="clientes()"
          [clienteInicial]="idcliente()"
          [label]="''"
          [placeholder]="'Selecione o cliente...'"
          [inputId]="'clienteFinanceiro'"
          [required]="true"
          (clienteSelecionado)="onClienteAutocompleteChange($event)"
        />
      </div>

      <div>
        <label for="descricao" class="block text-sm font-medium text-slate-300 mb-1">Descri√ß√£o *</label>
        <input id="descricao" name="descricao" required
               class="w-full px-3 py-2 border border-slate-600 rounded-md bg-slate-700 text-slate-200"
               [(ngModel)]="descricao">
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label for="valor" class="block text-sm font-medium text-slate-300 mb-1">Valor *</label>
        <input id="valor" name="valor" type="number" step="0.01" required
               class="w-full px-3 py-2 border border-slate-600 rounded-md bg-slate-700 text-slate-200"
               [(ngModel)]="valor">
      </div>

      <div>
        <label for="tipo" class="block text-sm font-medium text-slate-300 mb-1">Tipo *</label>
        <select id="tipo" name="tipo" required
                class="w-full px-3 py-2 border border-slate-600 rounded-md bg-slate-700 text-slate-200"
                [(ngModel)]="tipo">
          <option value="Receita">Receita</option>
          <option value="Despesa">Despesa</option>
        </select>
      </div>

      <div>
        <label for="status" class="block text-sm font-medium text-slate-300 mb-1">Status *</label>
        <select id="status" name="status" required
                class="w-full px-3 py-2 border border-slate-600 rounded-md bg-slate-700 text-slate-200"
                [(ngModel)]="status">
          <option value="Pendente">Pendente</option>
          <option value="Pago">Pago</option>
          <option value="Vencido">Vencido</option>
        </select>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label for="data" class="block text-sm font-medium text-slate-300 mb-1">Data *</label>
        <input id="data" name="data" type="date" required
               class="w-full px-3 py-2 border border-slate-600 rounded-md bg-slate-700 text-slate-200"
               [(ngModel)]="dataFormatada">
      </div>

      <div>
        <label for="vencimento" class="block text-sm font-medium text-slate-300 mb-1">Vencimento (opcional)</label>
        <input id="vencimento" name="vencimento" type="date"
               class="w-full px-3 py-2 border border-slate-600 rounded-md bg-slate-700 text-slate-200"
               [(ngModel)]="vencimentoFormatado">
      </div>
    </div>

    <div>
      <label for="observacoes" class="block text-sm font-medium text-slate-300 mb-1">Observa√ß√µes (opcional)</label>
      <textarea id="observacoes" name="observacoes"
                class="w-full px-3 py-2 border border-slate-600 rounded-md h-20 bg-slate-700 text-slate-200"
                [(ngModel)]="observacoes"></textarea>
    </div>

    <div class="flex justify-end gap-2">
      @if (financeiroSelecionado()) {
        <button type="button" (click)="limparFormulario()"
                class="px-4 py-2 bg-slate-600 text-white rounded-md font-semibold hover:bg-slate-700">
          Cancelar
        </button>
        <button type="submit"
                class="px-4 py-2 bg-amber-500 text-slate-900 rounded-md font-semibold hover:bg-amber-600">
          Atualizar Lan√ßamento
        </button>
      } @else {
        <button type="submit"
                class="px-4 py-2 bg-green-600 text-white rounded-md font-semibold hover:bg-green-700">
          Salvar Lan√ßamento
        </button>
      }
    </div>
  </form>

  <!-- Lista de Lan√ßamentos -->
  <section class="mt-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-semibold text-slate-100">Lan√ßamentos Financeiros</h2>
      <input type="text" placeholder="Filtrar por tipo, status ou descri√ß√£o..."
             class="px-3 py-2 border border-slate-600 rounded-md bg-slate-700 text-slate-200"
             [ngModel]="filtroTipo()" (ngModelChange)="filtroTipo.set($event)">
    </div>

    <div class="space-y-3">
      @for (fin of financeiroFiltrado(); track fin.idfinanceiro) {
        <div class="bg-slate-800/60 p-4 rounded-lg shadow-md"
             [class.border-l-4]="true"
             [class.border-green-500]="fin.tipo === 'Receita'"
             [class.border-red-500]="fin.tipo === 'Despesa'">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <span class="font-bold text-slate-100">{{ fin.descricao }}</span>
                <span class="px-2 py-1 rounded text-xs font-semibold"
                      [class.bg-green-500/20]="fin.tipo === 'Receita'"
                      [class.text-green-400]="fin.tipo === 'Receita'"
                      [class.bg-red-500/20]="fin.tipo === 'Despesa'"
                      [class.text-red-400]="fin.tipo === 'Despesa'">
                  {{ fin.tipo }}
                </span>
                <span class="px-2 py-1 rounded text-xs font-semibold"
                      [class.bg-amber-500/20]="fin.status === 'Pendente'"
                      [class.text-amber-400]="fin.status === 'Pendente'"
                      [class.bg-green-500/20]="fin.status === 'Pago'"
                      [class.text-green-400]="fin.status === 'Pago'"
                      [class.bg-red-500/20]="fin.status === 'Vencido'"
                      [class.text-red-400]="fin.status === 'Vencido'">
                  {{ fin.status }}
                </span>
              </div>
              <div class="text-sm text-slate-300">
                Cliente: {{ getClienteNome(fin.idcliente) }}
              </div>
              <div class="text-lg font-bold mt-2"
                   [class.text-green-400]="fin.tipo === 'Receita'"
                   [class.text-red-400]="fin.tipo === 'Despesa'">
                {{ fin.tipo === 'Receita' ? '+' : '-' }} {{ formatarMoeda(fin.valor) }}
              </div>
              <div class="text-xs text-slate-400 mt-2">
                Data: {{ fin.data_cadastro | date:'dd/MM/yyyy' }}
                @if (fin.vencimento) {
                  | Vencimento: {{ fin.vencimento | date:'dd/MM/yyyy' }}
                }
              </div>
              @if (fin.observacoes) {
                <div class="text-sm text-slate-400 mt-2 italic">{{ fin.observacoes }}</div>
              }
            </div>
            <div class="flex gap-2">
              <button (click)="editarFinanceiro(fin)"
                      class="px-3 py-1.5 bg-amber-500 text-white rounded-md text-sm hover:bg-amber-600">
                Editar
              </button>
              <button (click)="excluirFinanceiro(fin.idfinanceiro)"
                      class="px-3 py-1.5 bg-red-500 text-white rounded-md text-sm hover:bg-red-600">
                Excluir
              </button>
            </div>
          </div>
        </div>
      } @empty {
        <div class="bg-slate-800/60 p-4 rounded-lg shadow-sm text-center text-slate-400">
          Nenhum lan√ßamento financeiro cadastrado.
        </div>
      }
    </div>
  </section>
</div>

